<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" href="/images/main/main6.png" />
    <link rel="preconnect" href="https://res.cloudinary.com" crossorigin>
    <link rel="dns-prefetch" href="https://res.cloudinary.com">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>복지디자인 사회적협동조합</title>
    <!-- SEO meta -->
    <meta name="description" content="복지디자인 사회적협동조합 공식 홈페이지 - 복지디자인의 활동과 소식을 전해드립니다.">

    <!-- Open Graph -->
    <meta property="og:title" content="복지디자인 사회적협동조합" />
    <meta property="og:description" content="복지디자인 사회적협동조합의 활동과 소식을 전해드립니다." />
    <meta property="og:image" content="/images/main/main6.png" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://welfaredesign.netlify.app/" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="복지디자인 사회적협동조합" />
    <meta name="twitter:description" content="복지디자인 사회적협동조합의 활동과 소식을 전해드립니다." />
    <meta name="twitter:image" content="/images/main/main6.png" />
    <!-- Preload optimized hero image via Cloudinary (same visual, lighter bytes) -->
    <link rel="preload" as="image" crossorigin href="https://res.cloudinary.com/dxeadg9wi/image/fetch/c_limit,f_auto,q_auto,w_1600/https%3A%2F%2Fwelfaredesign.netlify.app%2Fimages%2Fmain.png">
  </head>
  <body>
    <div id="root"></div>
    <script>
      (function(){
        var CLOUD_FETCH_BASE = "https://res.cloudinary.com/dxeadg9wi/image/fetch/c_limit,f_auto,q_auto,w_1600";
        function normalize(url){ try { return new URL(url, location.origin).href; } catch(e) { return url; } }
        function toCloud(url){ return CLOUD_FETCH_BASE + "/" + encodeURIComponent(normalize(url)); }
        function isMain(src){
          try{
            var s = String(src || "");
            return s.endsWith("main.png") || s.indexOf("/images/main.png") > -1 || decodeURIComponent(s).indexOf("/images/main.png") > -1;
          }catch(e){ return false; }
        }
        // Patch setAttribute to catch early attribute sets
        var origSetAttr = Element.prototype.setAttribute;
        Element.prototype.setAttribute = function(name, value){
          if (this.tagName === 'IMG' && name === 'src' && isMain(value)) {
            value = toCloud(value);
          }
          return origSetAttr.call(this, name, value);
        };
        // Patch HTMLImageElement.src setter to intercept direct property assignment
        var desc = Object.getOwnPropertyDescriptor(HTMLImageElement.prototype, 'src');
        Object.defineProperty(HTMLImageElement.prototype, 'src', {
          configurable: true,
          get: desc.get,
          set: function(v){
            if (isMain(v)) v = toCloud(v);
            try { this.decoding = 'async'; } catch(_) {}
            return desc.set.call(this, v);
          }
        });
      })();
    </script>
    <script type="module" src="/src/main.jsx"></script>

    <!-- Netlify Identity widget: 초대/복구 토큰 처리 (홈은 그대로 유지) -->
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <script>
      (function () {
        // 초대/확인/복구 토큰(#invite_token 등) 있는지 확인
        var hash = window.location.hash || "";
        var m = hash.match(/(?:invite|confirmation|recovery)_token=([^&]+)/);

        if (!m) return; // 평소엔 아무것도 하지 않음

        function goAdmin() {
          try {
            // 해시 제거 (새로고침 시 반복 안 되도록)
            history.replaceState(null, "", window.location.pathname);
          } catch (e) {}
          window.location.href = "/admin/";
        }

        if (!window.netlifyIdentity) return;

        window.netlifyIdentity.on("init", function () {
          if (window.netlifyIdentity.acceptInvite) {
            window.netlifyIdentity
              .acceptInvite(m[1], true)
              .then(goAdmin)
              .catch(goAdmin);
          } else {
            window.netlifyIdentity.on("login", goAdmin);
          }
        });

        window.netlifyIdentity.init();
      })();
    </script>
    <script>
      (function(){
        var CLOUD_FETCH_BASE = "https://res.cloudinary.com/dxeadg9wi/image/fetch/c_limit,f_auto,q_auto,w_1600";
        function toCloudinary(url){
          try { return CLOUD_FETCH_BASE + "/" + encodeURIComponent(new URL(url, location.origin).href); } catch(e) { return url; }
        }
        function maybeSwap(img){
          if (!img || !img.getAttribute) return;
          var src = img.getAttribute("src");
          if (!src) return;
          if (src.includes("/images/main.png")) {
            var newSrc = toCloudinary(src);
            if (img.src !== newSrc) {
              img.decoding = "async";
              if (!img.hasAttribute("loading")) img.loading = "lazy"; // keep eager if author-set
              try { img.fetchPriority = img.getAttribute("loading") === "eager" ? "high" : "auto"; } catch(_) {}
              img.src = newSrc;
            }
          }
        }
        document.addEventListener("DOMContentLoaded", function(){
          document.querySelectorAll("img").forEach(maybeSwap);
          var mo = new MutationObserver(function(muts){
            muts.forEach(function(m){
              m.addedNodes && m.addedNodes.forEach(function(n){
                if (n && n.tagName === "IMG") maybeSwap(n);
                else if (n && n.querySelectorAll) n.querySelectorAll("img").forEach(maybeSwap);
              });
            });
          });
          mo.observe(document.documentElement, { childList: true, subtree: true });
        });
      })();
    </script>
  </body>
</html>