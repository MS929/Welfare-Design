<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Vite + React</title>
    <style id="cms-reset">
      /* 관리자 화면을 앱 전역 CSS로부터 보호 + 스크롤 보장 */
      html, body, #nc-root {
        height: auto !important;
        min-height: 100vh !important;
        overflow: auto !important;
      }
      #nc-root {
        position: static !important;
      }

      /* 에디터/패널 강제 높이 초기화 */
      .cms-editor-iframe,
      .DefaultControlPane_container,
      .Pane_content,
      .CollectionContainer_container,
      .DefaultCollectionPage_container,
      .EditorContainer_root {
        max-height: none !important;
        height: auto !important;
        min-height: 100% !important;
        overflow: auto !important;
      }
    </style>
    <style id="cms-scroll-enforce">
      html, body, #nc-root, #nc-root > div, main {
        height: auto !important;
        min-height: 100vh !important;
        overflow: auto !important;
        position: static !important;
      }
      /* Common Decap containers */
      .Pane_root, .Pane_content, .Pane_scrollContainer,
      .CollectionContainer_container,
      .DefaultCollectionPage_container,
      .DefaultControlPane_container,
      .EditorContainer_root,
      .cms-editor-iframe,
      .ReactVirtualized__Grid, .ReactVirtualized__List, .ReactVirtualized__Grid__innerScrollContainer {
        max-height: none !important;
        height: auto !important;
        min-height: 100% !important;
        overflow: auto !important;
      }
      /* Guard against any overflow:hidden leaking in */
      *[style*="overflow: hidden"], *[style*="overflow:hidden"] {
        overflow: auto !important;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>

    <!-- Netlify Identity widget: 초대/복구 토큰 처리 (홈은 그대로 유지) -->
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <script>
      (function () {
        // 초대/확인/복구 토큰(#invite_token 등) 있는지 확인
        var hash = window.location.hash || "";
        var m = hash.match(/(?:invite|confirmation|recovery)_token=([^&]+)/);

        if (!m) return; // 평소엔 아무것도 하지 않음

        function goAdmin() {
          try {
            // 해시 제거 (새로고침 시 반복 안 되도록)
            history.replaceState(null, "", window.location.pathname);
          } catch (e) {}
          window.location.href = "/admin/";
        }

        if (!window.netlifyIdentity) return;

        window.netlifyIdentity.on("init", function () {
          if (window.netlifyIdentity.acceptInvite) {
            window.netlifyIdentity
              .acceptInvite(m[1], true)
              .then(goAdmin)
              .catch(goAdmin);
          } else {
            window.netlifyIdentity.on("login", goAdmin);
          }
        });

        window.netlifyIdentity.init();
      })();
    </script>
    <script id="cms-scroll-enforce-runtime">
      (function () {
        function enforceOnce() {
          try {
            var targets = [document.documentElement, document.body, document.getElementById('nc-root')];
            targets.forEach(function (el) {
              if (!el) return;
              el.style.setProperty('overflow', 'auto', 'important');
              el.style.setProperty('height', 'auto', 'important');
              el.style.setProperty('min-height', '100vh', 'important');
              el.style.setProperty('position', 'static', 'important');
            });
            var sels = [
              'main', '.Pane_root', '.Pane_content', '.Pane_scrollContainer',
              '.CollectionContainer_container', '.DefaultCollectionPage_container',
              '.DefaultControlPane_container', '.EditorContainer_root',
              '.ReactVirtualized__Grid', '.ReactVirtualized__List', '.ReactVirtualized__Grid__innerScrollContainer'
            ];
            sels.forEach(function (sel) {
              document.querySelectorAll(sel).forEach(function (el) {
                el.style.setProperty('max-height', 'none', 'important');
                el.style.setProperty('height', 'auto', 'important');
                el.style.setProperty('min-height', '100%', 'important');
                el.style.setProperty('overflow', 'auto', 'important');
              });
            });
          } catch (e) {}
        }
        function enforceBurst() {
          var n = 0, timer = setInterval(function(){
            enforceOnce();
            if (++n > 40) clearInterval(timer); // ~20s max
          }, 500);
        }
        document.addEventListener('DOMContentLoaded', enforceBurst);
        window.addEventListener('load', enforceBurst);
        window.addEventListener('resize', enforceOnce);
        var _push = history.pushState; history.pushState = function(){ _push.apply(this, arguments); setTimeout(enforceBurst, 100); };
        var _replace = history.replaceState; history.replaceState = function(){ _replace.apply(this, arguments); setTimeout(enforceBurst, 100); };
      })();
    </script>
  </body>
</html>