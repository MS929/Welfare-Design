<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Vite + React</title>
  </head>
    <!-- Netlify Identity widget: 초대/복구 토큰 처리 + 로그인 후 /admin 으로 이동 -->
<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
<script>
  (function () {
    // 해시에 초대/확인/복구 토큰이 붙어온 경우 처리
    const hash = window.location.hash || "";
    const m = hash.match(/(?:invite|confirmation|recovery)_token=([^&]+)/);

    function goAdminSoon() {
      // 로그인 직후 /admin 으로 이동
      setTimeout(() => (window.location.href = "/admin/"), 300);
    }

    if (window.netlifyIdentity) {
      window.netlifyIdentity.on("init", (user) => {
        if (user) {
          // 이미 로그인 상태면 CMS로
          goAdminSoon();
          return;
        }

        // 초대/복구 토큰이 있으면 위젯이 처리하도록 초기화
        if (m) {
          window.netlifyIdentity
            .acceptInvite
              ? window.netlifyIdentity
                  .acceptInvite(m[1], true) // 자동 로그인
                  .then(goAdminSoon)
                  .catch(goAdminSoon)
              : window.netlifyIdentity.on("login", goAdminSoon);
        } else {
          // 평소에는 로그인하면 CMS로
          window.netlifyIdentity.on("login", goAdminSoon);
        }
      });

      // 위젯 초기화
      window.netlifyIdentity.init();
    }
  })();
</script>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
    
  </body>
</html>
